<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아산시 강소형 스마트시티 조성사업 | 통합 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.1/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a56db;
            --primary-light: #3b82f6;
            --primary-dark: #1e40af;
            --success: #059669;
            --success-light: #d1fae5;
            --warning: #d97706;
            --warning-light: #fef3c7;
            --danger: #dc2626;
            --danger-light: #fee2e2;
            --info: #0891b2;
            --info-light: #cffafe;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            color: var(--white);
            padding: 0 32px;
            box-shadow: var(--shadow-md);
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 72px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .logo-text h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.85;
            font-weight: 400;
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            font-size: 13px;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
        }

        .sync-dot.syncing {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: var(--white);
            color: var(--primary);
            text-decoration: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background: var(--gray-100);
            transform: translateY(-1px);
        }

        /* Main */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 32px;
        }

        /* Summary Bar */
        .summary-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-item {
            background: var(--white);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .summary-item.success { border-left-color: var(--success); }
        .summary-item.warning { border-left-color: var(--warning); }
        .summary-item.danger { border-left-color: var(--danger); }
        .summary-item.info { border-left-color: var(--info); }

        .summary-label {
            font-size: 12px;
            color: var(--gray-500);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .summary-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .summary-value span {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-500);
        }

        .summary-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            margin-top: 8px;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .summary-change.up { background: var(--success-light); color: var(--success); }
        .summary-change.down { background: var(--danger-light); color: var(--danger); }
        .summary-change.neutral { background: var(--gray-100); color: var(--gray-600); }

        /* Section */
        .section {
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .section-title i {
            color: var(--primary);
            font-size: 20px;
        }

        .section-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 4px;
            border: 1px solid var(--gray-300);
            background: var(--white);
            color: var(--gray-600);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .btn-sm:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .btn-sm.primary {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .btn-sm.primary:hover {
            background: var(--primary-dark);
        }

        /* Card */
        .card {
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .card-body {
            padding: 20px;
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: var(--gray-50);
        }

        .data-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--gray-200);
        }

        .data-table td {
            padding: 14px 16px;
            font-size: 13px;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-100);
        }

        .data-table tbody tr:hover {
            background: var(--gray-50);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .project-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        .project-desc {
            font-size: 11px;
            color: var(--gray-400);
            margin-top: 2px;
        }

        .amount {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--primary);
        }

        .rate-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rate-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            min-width: 45px;
        }

        .rate-bar {
            flex: 1;
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
            max-width: 100px;
        }

        .rate-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .rate-fill.high { background: var(--success); }
        .rate-fill.mid { background: var(--primary); }
        .rate-fill.low { background: var(--warning); }
        .rate-fill.zero { background: var(--gray-300); }

        /* Status Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge.completed { background: var(--success-light); color: var(--success); }
        .badge.progress { background: #dbeafe; color: var(--primary); }
        .badge.pending { background: var(--warning-light); color: var(--warning); }
        .badge.new { background: #f3e8ff; color: #7c3aed; }
        .badge.urgent { background: var(--danger-light); color: var(--danger); }

        /* Chart Container */
        .chart-container {
            height: 280px;
            position: relative;
        }

        /* Budget Table */
        .budget-table {
            width: 100%;
            border-collapse: collapse;
        }

        .budget-table th,
        .budget-table td {
            padding: 12px;
            text-align: right;
            font-size: 13px;
            border-bottom: 1px solid var(--gray-200);
        }

        .budget-table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-600);
        }

        .budget-table td:first-child,
        .budget-table th:first-child {
            text-align: left;
            font-weight: 600;
        }

        .budget-table .total-row {
            background: var(--primary);
            color: var(--white);
        }

        .budget-table .total-row td {
            font-weight: 700;
            border-bottom: none;
        }

        /* Risk List */
        .risk-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .risk-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            border-radius: 6px;
            border: 1px solid var(--gray-200);
        }

        .risk-item.critical {
            background: #fef2f2;
            border-color: #fecaca;
        }

        .risk-item.high {
            background: #fffbeb;
            border-color: #fde68a;
        }

        .risk-level {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .risk-level.critical { background: var(--danger); color: var(--white); }
        .risk-level.high { background: var(--warning); color: var(--white); }

        .risk-content {
            flex: 1;
        }

        .risk-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .risk-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--gray-500);
        }

        .risk-amount {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .risk-item.critical .risk-amount { color: var(--danger); }
        .risk-item.high .risk-amount { color: var(--warning); }

        /* Timeline */
        .timeline {
            display: flex;
            flex-direction: column;
        }

        .timeline-item {
            display: flex;
            gap: 16px;
            padding: 14px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        .timeline-date {
            min-width: 60px;
            text-align: center;
        }

        .timeline-day {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .timeline-month {
            font-size: 11px;
            color: var(--gray-400);
            font-weight: 500;
        }

        .timeline-item.today .timeline-day {
            color: var(--danger);
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .timeline-desc {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Plan Cards */
        .plan-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .plan-card {
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .plan-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .plan-card:nth-child(1) .plan-icon { background: var(--warning-light); color: var(--warning); }
        .plan-card:nth-child(2) .plan-icon { background: #dbeafe; color: var(--primary); }
        .plan-card:nth-child(3) .plan-icon { background: #f3e8ff; color: #7c3aed; }

        .plan-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 6px;
        }

        .plan-desc {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .plan-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Footer */
        .footer {
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            padding: 24px 32px;
            margin-top: 24px;
        }

        .footer-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .footer-info {
            font-size: 12px;
            color: var(--gray-500);
        }

        .footer-links {
            display: flex;
            gap: 24px;
        }

        .footer-links a {
            font-size: 12px;
            color: var(--gray-500);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            text-align: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .summary-bar { grid-template-columns: repeat(3, 1fr); }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .plan-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .header-inner { flex-direction: column; height: auto; padding: 16px 0; gap: 12px; }
            .summary-bar { grid-template-columns: 1fr 1fr; }
            .main { padding: 16px; }
            .data-table { font-size: 12px; }
            .data-table th, .data-table td { padding: 10px 8px; }
        }

        /* Print Styles */
        @media print {
            .header-meta, .section-actions, .btn-sm { display: none; }
            .card { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>노션 데이터 동기화 중...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <div class="logo">
                <div class="logo-icon">
                    <i class="ri-building-4-fill"></i>
                </div>
                <div class="logo-text">
                    <h1>아산시 강소형 스마트시티 조성사업</h1>
                    <p>통합 프로젝트 관리 대시보드</p>
                </div>
            </div>
            <div class="header-meta">
                <div class="sync-status">
                    <span class="sync-dot" id="syncDot"></span>
                    <span id="syncText">마지막 동기화: 2025.11.27 17:45</span>
                </div>
                <button class="header-btn" onclick="syncWithNotion()" id="syncBtn">
                    <i class="ri-refresh-line"></i>
                    노션 동기화
                </button>
                <a href="https://www.notion.so/21650aa9577d80dc8278e0187c54677f" class="header-btn" target="_blank">
                    <i class="ri-external-link-line"></i>
                    노션 열기
                </a>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="main">
        <!-- Summary Bar -->
        <div class="summary-bar">
            <div class="summary-item">
                <div class="summary-label">총 사업비</div>
                <div class="summary-value" id="totalBudget">240<span>억원</span></div>
                <div class="summary-change neutral">
                    <i class="ri-government-line"></i>
                    국비 120억 + 지방비 120억
                </div>
            </div>
            <div class="summary-item warning">
                <div class="summary-label">예산 집행률</div>
                <div class="summary-value" id="executionRate">14.8<span>%</span></div>
                <div class="summary-change down">
                    <i class="ri-arrow-down-s-line"></i>
                    목표 대비 저조
                </div>
            </div>
            <div class="summary-item">
                <div class="summary-label">계약금액</div>
                <div class="summary-value" id="contractAmount">33.58<span>억원</span></div>
                <div class="summary-change up">
                    <i class="ri-arrow-up-s-line"></i>
                    +8억 (11/20)
                </div>
            </div>
            <div class="summary-item success">
                <div class="summary-label">집행금액</div>
                <div class="summary-value" id="executedAmount">25.3<span>억원</span></div>
                <div class="summary-change neutral">
                    잔액 146.04억원
                </div>
            </div>
            <div class="summary-item danger">
                <div class="summary-label">사업 종료까지</div>
                <div class="summary-value" id="dday">D-34</div>
                <div class="summary-change down">
                    <i class="ri-calendar-line"></i>
                    2025.12.31
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <section class="section">
            <div class="grid-2">
                <!-- Budget by Source -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">재원별 예산 현황</span>
                    </div>
                    <div class="card-body">
                        <table class="budget-table">
                            <thead>
                                <tr>
                                    <th>재원</th>
                                    <th>총액</th>
                                    <th>배정예산</th>
                                    <th>집행금액</th>
                                    <th>집행률</th>
                                </tr>
                            </thead>
                            <tbody id="budgetTableBody">
                                <tr>
                                    <td>국비</td>
                                    <td>120.00억</td>
                                    <td>85.70억</td>
                                    <td>12.70억</td>
                                    <td>10.6%</td>
                                </tr>
                                <tr>
                                    <td>도비</td>
                                    <td>28.80억</td>
                                    <td>20.60억</td>
                                    <td>3.00억</td>
                                    <td>10.4%</td>
                                </tr>
                                <tr>
                                    <td>시비</td>
                                    <td>91.20억</td>
                                    <td>65.00억</td>
                                    <td>9.60억</td>
                                    <td>10.5%</td>
                                </tr>
                                <tr class="total-row">
                                    <td>합계</td>
                                    <td>240.00억</td>
                                    <td>171.34억</td>
                                    <td>25.30억</td>
                                    <td>14.8%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Chart -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">재원별 집행 현황 (차트)</span>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="budgetChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Projects Table -->
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="ri-folder-chart-line"></i>
                    단위사업별 현황
                </h2>
                <div class="section-actions">
                    <button class="btn-sm" onclick="exportToExcel()">
                        <i class="ri-file-excel-line"></i>
                        엑셀 다운로드
                    </button>
                    <button class="btn-sm primary" onclick="syncWithNotion()">
                        <i class="ri-refresh-line"></i>
                        새로고침
                    </button>
                </div>
            </div>
            <div class="card">
                <table class="data-table" id="projectsTable">
                    <thead>
                        <tr>
                            <th style="width: 25%">단위사업</th>
                            <th style="width: 12%">예산</th>
                            <th style="width: 18%">집행률</th>
                            <th style="width: 12%">계약금액</th>
                            <th style="width: 15%">진행상태</th>
                            <th style="width: 18%">비고</th>
                        </tr>
                    </thead>
                    <tbody id="projectsTableBody">
                        <tr>
                            <td>
                                <div class="project-name">디지털 OASIS SPOT 구축</div>
                                <div class="project-desc">이동식 체류공간 30동, 스마트인프라</div>
                            </td>
                            <td class="amount">35.54억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">1.2%</span>
                                    <div class="rate-bar"><div class="rate-fill low" style="width: 1.2%"></div></div>
                                </div>
                            </td>
                            <td class="amount">0.43억</td>
                            <td><span class="badge pending"><i class="ri-pencil-ruler-2-line"></i> 실시설계</span></td>
                            <td>부지 확정 완료 (도고면)</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">이노베이션센터 구축</div>
                                <div class="project-desc">호서대 KTX캠퍼스 통합관제센터</div>
                            </td>
                            <td class="amount">13.30억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">93.4%</span>
                                    <div class="rate-bar"><div class="rate-fill high" style="width: 93.4%"></div></div>
                                </div>
                            </td>
                            <td class="amount">12.43억</td>
                            <td><span class="badge completed"><i class="ri-check-line"></i> 구축완료</span></td>
                            <td>운영 준비중</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">유무선 네트워크 구축</div>
                                <div class="project-desc">광케이블 30km, WiFi AP 200개</div>
                            </td>
                            <td class="amount">8.00억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">96.2%</span>
                                    <div class="rate-bar"><div class="rate-fill high" style="width: 96.2%"></div></div>
                                </div>
                            </td>
                            <td class="amount">7.70억</td>
                            <td><span class="badge completed"><i class="ri-check-line"></i> 계약완료</span></td>
                            <td>11/20 계약체결</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">SDDC Platform 구축</div>
                                <div class="project-desc">클라우드 기반 데이터센터</div>
                            </td>
                            <td class="amount">27.00억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">0%</span>
                                    <div class="rate-bar"><div class="rate-fill zero" style="width: 0%"></div></div>
                                </div>
                            </td>
                            <td class="amount">-</td>
                            <td><span class="badge progress"><i class="ri-settings-3-line"></i> 기술협상</span></td>
                            <td>3차 협상 완료 (11/26)</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">AI통합관제 플랫폼</div>
                                <div class="project-desc">AI 영상분석, 예측 분석</div>
                            </td>
                            <td class="amount">16.00억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">0%</span>
                                    <div class="rate-bar"><div class="rate-fill zero" style="width: 0%"></div></div>
                                </div>
                            </td>
                            <td class="amount">-</td>
                            <td><span class="badge progress"><i class="ri-file-list-3-line"></i> 계약예정</span></td>
                            <td>11/29 계약 목표</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">디지털OASIS 정보관리</div>
                                <div class="project-desc">데이터 마켓플레이스, API</div>
                            </td>
                            <td class="amount">23.00억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">0%</span>
                                    <div class="rate-bar"><div class="rate-fill zero" style="width: 0%"></div></div>
                                </div>
                            </td>
                            <td class="amount">-</td>
                            <td><span class="badge pending"><i class="ri-auction-line"></i> 입찰공고</span></td>
                            <td>12/08 선정 목표</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">DRT 서비스 구축</div>
                                <div class="project-desc">수요응답형 모빌리티</div>
                            </td>
                            <td class="amount">10.00억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">5.0%</span>
                                    <div class="rate-bar"><div class="rate-fill low" style="width: 5%"></div></div>
                                </div>
                            </td>
                            <td class="amount">0.50억</td>
                            <td><span class="badge pending"><i class="ri-bus-line"></i> 발주진행</span></td>
                            <td>차량 2대 발주중</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">사업관리 (PMO)</div>
                                <div class="project-desc">인건비, 운영비, 여비</div>
                            </td>
                            <td class="amount">28.21억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">-</span>
                                    <div class="rate-bar"><div class="rate-fill mid" style="width: 50%"></div></div>
                                </div>
                            </td>
                            <td class="amount">12.24억</td>
                            <td><span class="badge progress"><i class="ri-team-line"></i> 진행중</span></td>
                            <td>PMO 운영</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="project-name">감리용역 (신설)</div>
                                <div class="project-desc">서비스 인프라 구축 투명성 제고</div>
                            </td>
                            <td class="amount">1.60억</td>
                            <td>
                                <div class="rate-cell">
                                    <span class="rate-value">0%</span>
                                    <div class="rate-bar"><div class="rate-fill zero" style="width: 0%"></div></div>
                                </div>
                            </td>
                            <td class="amount">-</td>
                            <td><span class="badge new"><i class="ri-add-circle-line"></i> 신설</span></td>
                            <td>예산 신설 추진중</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Risk & Timeline -->
        <section class="section">
            <div class="grid-2">
                <!-- Risk -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">주요 리스크 현황</span>
                        <span class="badge urgent">8건</span>
                    </div>
                    <div class="card-body">
                        <div class="risk-list" id="riskList">
                            <div class="risk-item critical">
                                <span class="risk-level critical">긴급</span>
                                <div class="risk-content">
                                    <div class="risk-title">연말 예산집행률 저조</div>
                                    <div class="risk-meta">
                                        <span>발생확률: 81-100%</span>
                                        <span class="risk-amount">예상손실: 146억원</span>
                                    </div>
                                </div>
                            </div>
                            <div class="risk-item critical">
                                <span class="risk-level critical">긴급</span>
                                <div class="risk-content">
                                    <div class="risk-title">SDDC Platform 구축 발주 지연</div>
                                    <div class="risk-meta">
                                        <span>발생확률: 61-80%</span>
                                        <span class="risk-amount">예상손실: 27억원</span>
                                    </div>
                                </div>
                            </div>
                            <div class="risk-item high">
                                <span class="risk-level high">높음</span>
                                <div class="risk-content">
                                    <div class="risk-title">디지털OASIS 정보관리 발주 지연</div>
                                    <div class="risk-meta">
                                        <span>발생확률: 41-60%</span>
                                        <span class="risk-amount">예상손실: 25억원</span>
                                    </div>
                                </div>
                            </div>
                            <div class="risk-item high">
                                <span class="risk-level high">높음</span>
                                <div class="risk-content">
                                    <div class="risk-title">AI통합관제 플랫폼 발주 지연</div>
                                    <div class="risk-meta">
                                        <span>발생확률: 41-60%</span>
                                        <span class="risk-amount">예상손실: 16억원</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">주요 일정</span>
                    </div>
                    <div class="card-body">
                        <div class="timeline" id="timeline">
                            <div class="timeline-item today">
                                <div class="timeline-date">
                                    <div class="timeline-day">27</div>
                                    <div class="timeline-month">11월</div>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-title">서비스 인프라 우선협상 기간 종료</div>
                                    <div class="timeline-desc">기술협상 완료, 계약 준비</div>
                                </div>
                                <span class="badge urgent">D-Day</span>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">
                                    <div class="timeline-day">29</div>
                                    <div class="timeline-month">11월</div>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-title">AI통합관제 계약 체결</div>
                                    <div class="timeline-desc">11월 실적 최종 점검</div>
                                </div>
                                <span class="badge progress">D-2</span>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">
                                    <div class="timeline-day">05</div>
                                    <div class="timeline-month">12월</div>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-title">SDDC Platform 계약 체결</div>
                                    <div class="timeline-desc">27억원 규모</div>
                                </div>
                                <span class="badge pending">D-8</span>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">
                                    <div class="timeline-day">31</div>
                                    <div class="timeline-month">12월</div>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-title">사업년도 종료 / 예산 마감</div>
                                    <div class="timeline-desc">2025년 사업 종료</div>
                                </div>
                                <span class="badge urgent">D-34</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Plan Changes -->
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="ri-file-edit-line"></i>
                    2025년 11월 실시계획 변경 추진사항
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="plan-grid">
                        <div class="plan-card">
                            <div class="plan-icon"><i class="ri-time-line"></i></div>
                            <div class="plan-title">사업기간 연장</div>
                            <div class="plan-desc">
                                단위사업별 5~8개월 연장 신청<br>
                                OASIS SPOT 대상지 최종 확정 선행 필요
                            </div>
                            <div class="plan-value">5~8개월</div>
                        </div>
                        <div class="plan-card">
                            <div class="plan-icon"><i class="ri-money-dollar-circle-line"></i></div>
                            <div class="plan-title">감리용역비 신설</div>
                            <div class="plan-desc">
                                개발비 비목 신설<br>
                                서비스 인프라 구축용역 투명성 제고
                            </div>
                            <div class="plan-value">1.6억원</div>
                        </div>
                        <div class="plan-card">
                            <div class="plan-icon"><i class="ri-exchange-funds-line"></i></div>
                            <div class="plan-title">예산 재편성</div>
                            <div class="plan-desc">
                                총액 유지 (국비 120억 + 지방비 120억)<br>
                                투찰금액 차액 환수 → 26년 인건비 활용
                            </div>
                            <div class="plan-value">240억원</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <div class="footer-info">
                <strong>아산시 강소형 스마트시티 조성사업 PMO</strong><br>
                © 2025 제일엔지니어링 | 담당: 이성호 (airlan506@icloud.com)
            </div>
            <div class="footer-links">
                <a href="https://www.notion.so/21650aa9577d80dc8278e0187c54677f" target="_blank">
                    <i class="ri-notion-fill"></i>
                    노션 프로젝트 관리
                </a>
                <a href="https://www.notion.so/2aa50aa9577d8128b6d4c5c21d845796" target="_blank">
                    <i class="ri-database-2-line"></i>
                    예산관리 시스템
                </a>
                <a href="https://github.com/leesungho-ai/Asan-smartcity-budget" target="_blank">
                    <i class="ri-github-fill"></i>
                    GitHub
                </a>
            </div>
        </div>
    </footer>

    <script>
        // ==================== 노션 동기화 설정 ====================
        const NOTION_CONFIG = {
            // 노션 페이지 ID (실제 사용 시 본인의 Integration Token 필요)
            dashboardPageId: '25a50aa9-577d-81b0-9085-e918f674b7ce',
            budgetDatabaseId: '2aa50aa9-577d-8128-b6d4-c5c21d845796',
            // 동기화 간격 (밀리초) - 5분마다 자동 동기화
            syncInterval: 5 * 60 * 1000,
            // 마지막 동기화 시간
            lastSync: null
        };

        // ==================== 차트 초기화 ====================
        Chart.defaults.font.family = "'Noto Sans KR', sans-serif";
        
        const budgetCtx = document.getElementById('budgetChart').getContext('2d');
        const budgetChart = new Chart(budgetCtx, {
            type: 'bar',
            data: {
                labels: ['국비', '도비', '시비'],
                datasets: [{
                    label: '배정예산',
                    data: [85.7, 20.6, 65.0],
                    backgroundColor: 'rgba(26, 86, 219, 0.2)',
                    borderColor: '#1a56db',
                    borderWidth: 2,
                    borderRadius: 4,
                }, {
                    label: '집행금액',
                    data: [12.7, 3.0, 9.6],
                    backgroundColor: 'rgba(5, 150, 105, 0.8)',
                    borderColor: '#059669',
                    borderWidth: 2,
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'rectRounded'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        title: {
                            display: true,
                            text: '금액 (억원)',
                            font: { size: 11 }
                        }
                    }
                }
            }
        });

        // ==================== 노션 동기화 함수 ====================
        async function syncWithNotion() {
            const syncDot = document.getElementById('syncDot');
            const syncText = document.getElementById('syncText');
            const syncBtn = document.getElementById('syncBtn');
            const loadingOverlay = document.getElementById('loadingOverlay');

            // 동기화 시작
            syncDot.classList.add('syncing');
            syncBtn.disabled = true;
            syncBtn.innerHTML = '<i class="ri-loader-4-line"></i> 동기화 중...';
            loadingOverlay.classList.add('active');

            try {
                // 실제 노션 API 연동 시 사용할 코드
                // 주의: 클라이언트 사이드에서는 CORS 문제로 직접 호출 불가
                // 서버 사이드 프록시 또는 Cloudflare Workers 등 필요
                
                /*
                const response = await fetch('YOUR_PROXY_URL/notion-sync', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pageId: NOTION_CONFIG.dashboardPageId,
                        databaseId: NOTION_CONFIG.budgetDatabaseId
                    })
                });
                
                const data = await response.json();
                updateDashboard(data);
                */

                // 데모용: 2초 후 완료 처리
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 동기화 완료 시간 업데이트
                const now = new Date();
                const timeStr = now.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                NOTION_CONFIG.lastSync = now;
                syncText.textContent = `마지막 동기화: ${timeStr}`;
                
                // 성공 알림
                showNotification('노션 데이터가 성공적으로 동기화되었습니다.', 'success');

            } catch (error) {
                console.error('동기화 실패:', error);
                showNotification('동기화 중 오류가 발생했습니다.', 'error');
            } finally {
                // 동기화 완료
                syncDot.classList.remove('syncing');
                syncBtn.disabled = false;
                syncBtn.innerHTML = '<i class="ri-refresh-line"></i> 노션 동기화';
                loadingOverlay.classList.remove('active');
            }
        }

        // ==================== 대시보드 데이터 업데이트 ====================
        function updateDashboard(data) {
            // 요약 정보 업데이트
            if (data.summary) {
                document.getElementById('totalBudget').innerHTML = 
                    `${data.summary.totalBudget}<span>억원</span>`;
                document.getElementById('executionRate').innerHTML = 
                    `${data.summary.executionRate}<span>%</span>`;
                document.getElementById('contractAmount').innerHTML = 
                    `${data.summary.contractAmount}<span>억원</span>`;
                document.getElementById('executedAmount').innerHTML = 
                    `${data.summary.executedAmount}<span>억원</span>`;
            }

            // 차트 업데이트
            if (data.budgetBySource) {
                budgetChart.data.datasets[0].data = data.budgetBySource.allocated;
                budgetChart.data.datasets[1].data = data.budgetBySource.executed;
                budgetChart.update();
            }

            // 프로젝트 테이블 업데이트
            if (data.projects) {
                updateProjectsTable(data.projects);
            }

            // 리스크 업데이트
            if (data.risks) {
                updateRiskList(data.risks);
            }
        }

        // ==================== 알림 표시 ====================
        function showNotification(message, type) {
            // 간단한 알림 (필요 시 더 정교하게 구현)
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // ==================== 엑셀 다운로드 ====================
        function exportToExcel() {
            // CSV 형식으로 다운로드
            const table = document.getElementById('projectsTable');
            let csv = [];
            
            // 헤더
            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                headers.push(th.textContent);
            });
            csv.push(headers.join(','));
            
            // 데이터
            table.querySelectorAll('tbody tr').forEach(tr => {
                const row = [];
                tr.querySelectorAll('td').forEach(td => {
                    let text = td.textContent.replace(/,/g, '').trim();
                    text = text.replace(/\n/g, ' ');
                    row.push(`"${text}"`);
                });
                csv.push(row.join(','));
            });
            
            // 다운로드
            const csvContent = '\uFEFF' + csv.join('\n'); // BOM for Korean
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `아산스마트시티_단위사업현황_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ==================== 자동 동기화 설정 ====================
        function startAutoSync() {
            setInterval(() => {
                console.log('자동 동기화 실행...');
                syncWithNotion();
            }, NOTION_CONFIG.syncInterval);
        }

        // ==================== D-Day 계산 ====================
        function updateDDay() {
            const endDate = new Date('2025-12-31');
            const today = new Date();
            const diff = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            document.getElementById('dday').textContent = `D-${diff}`;
        }

        // ==================== 초기화 ====================
        document.addEventListener('DOMContentLoaded', function() {
            updateDDay();
            // 자동 동기화 시작 (옵션)
            // startAutoSync();
            
            console.log('대시보드 초기화 완료');
            console.log('노션 연동을 위해서는 서버 사이드 프록시가 필요합니다.');
            console.log('자세한 설정 방법은 README.md를 참조하세요.');
        });
    </script>
</body>
</html>
